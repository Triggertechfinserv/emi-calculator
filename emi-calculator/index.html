<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Primary SEO -->
  <title>Online EMI Calculator with Part-Payment ‚Äî TechFinserv</title>
  <meta name="description" content="Smart EMI calculator for home, car & personal loans. Use part-payments, see instant amortization, export to PDF/Excel, and get complete loan planning for 2025">
  <link rel="canonical" href="https://www.techfinserv.com/emi-calculator/">
  <meta name="robots" content="index, follow, max-image-preview:large">  

  <!-- Hreflang (adjust if you have more locales) -->
  <link rel="alternate" href="https://www.techfinserv.com/emi-calculator/" hreflang="en-IN">
  <link rel="alternate" href="https://www.techfinserv.com/emi-calculator/" hreflang="x-default">

  <!-- Performance niceties -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <!-- Open Graph (Facebook, LinkedIn, WhatsApp, Telegram) -->
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="TechFinserv">
  <meta property="og:locale" content="en_IN">
  <meta property="og:title" content="Online EMI Calculator with Part-Payment ‚Äî TechFinserv">
  <meta property="og:description" content="Smart EMI calculator for home, car & personal loans. Use part-payments, see instant amortization, export to PDF/Excel, and get complete loan planning for 2025.">
  <meta property="og:url" content="https://www.techfinserv.com/emi-calculator/">
  <meta property="fb:app_id" content="966242223397117">


  <!-- IMPORTANT: Use JPG/PNG for OG (not WebP) -->
  <meta property="og:image" content="https://www.techfinserv.com/images/emi-calculator/emi-calculator.jpg">
  <meta property="og:image:secure_url" content="https://www.techfinserv.com/images/emi-calculator/emi-calculator.jpg">
  <meta property="og:image:type" content="image/jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Smart EMI calculator for home, car & personal loans.With part-payments. (infographic)">

  <!-- Twitter / X -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@TechFinservIN">        <!-- your handle -->
  <meta name="twitter:creator" content="@TechFinservIN">     <!-- your handle -->
  <meta name="twitter:title" content="Online EMI Calculator with Part-Payment ‚Äî TechFinserv">
  <meta name="twitter:description" content="Smart EMI calculator for home, car & personal loans.With part-payments.">
  <meta name="twitter:image" content="https://www.techfinserv.com/images/emi-calculator/emi-calculator.jpg">
  <meta name="twitter:image:alt" content="Smart EMI calculator for home, car & personal loans.With part-payments.">

  <!-- Favicons / PWA (optional but good) -->
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <link rel="apple-touch-icon" href="/images/favicon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#0ea5e9">
  
  <!-- AdSense loader: include ONCE -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4180233192929131"
          crossorigin="anonymous"></script>

  <!-- Third-party libs for export -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver/dist/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <!-- Chart.js for doughnut charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9DHT9T8GZB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-9DHT9T8GZB');
  </script>

  <!-- MicrosoftClarity -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "u8560jazbw");
   </script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "https://www.techfinserv.com/#organization",
      "name": "TechFinserv",
      "url": "https://www.techfinserv.com/",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.techfinserv.com/images/techfinserv-logo.png",
        "width": 600,
        "height": 60
      },
      "sameAs": [
        "https://x.com/TechFinservIN",
        "https://www.facebook.com/profile.php?id=61583100667662",
        "https://www.instagram.com/techfinserv",
        "https://www.youtube.com/@TechFinservyt",
        "https://www.linkedin.com/company/techfinserv/"
      ]
    },
    {
      "@type": "WebSite",
      "@id": "https://www.techfinserv.com/#website",
      "url": "https://www.techfinserv.com/",
      "name": "TechFinserv",
      "publisher": { "@id": "https://www.techfinserv.com/#organization" },
      "inLanguage": "en-IN",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://www.techfinserv.com/search/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    },
    {
      "@type": "WebPage",
      "@id": "https://www.techfinserv.com/emi-calculator/#webpage",
      "url": "https://www.techfinserv.com/emi-calculator/",
      "name": "Online EMI Calculator with Part-Payment ‚Äî TechFinserv",
      "isPartOf": { "@id": "https://www.techfinserv.com/#website" },
      "breadcrumb": { "@id": "https://www.techfinserv.com/emi-calculator/#breadcrumbs" },
      "primaryImageOfPage": {
        "@type": "ImageObject",
        "url": "https://www.techfinserv.com/images/emi-calculator/emi-calculator.jpg",
        "width": 1200,
        "height": 630
      },
      "datePublished": "2025-10-21T00:00:00+05:30",
      "dateModified": "2025-10-21T00:00:00+05:30",
      "inLanguage": "en-IN"
    },
    {
      "@type": "BreadcrumbList",
      "@id": "https://www.techfinserv.com/emi-calculator/#breadcrumbs",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://www.techfinserv.com/" },
        { "@type": "ListItem", "position": 2, "name": "EMI Calculator", "item": "https://www.techfinserv.com/emi-calculator/" }
      ]
    },
    {
      "@type": "WebApplication",
      "@id": "https://www.techfinserv.com/emi-calculator/#app",
      "name": "Online EMI Calculator with Part-Payment ‚Äî TechFinserv",
      "url": "https://www.techfinserv.com/emi-calculator/",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Web",
      "description": "EMI calculator for home, personal and car loans with part-payment support, instant amortization schedule, and PDF/Excel export.",
      "screenshot": "https://www.techfinserv.com/images/emi-calculator/emi-calculator.jpg",
      "publisher": { "@id": "https://www.techfinserv.com/#organization" },
      "inLanguage": "en-IN"
    },
    {
      "@type": "FAQPage",
      "@id": "https://www.techfinserv.com/emi-calculator/#faq",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Does EMI change every month?",
          "acceptedAnswer": { "@type": "Answer", "text": "For fixed-rate loans, the EMI stays constant but the interest/principal split changes over time. For floating-rate loans, lenders may change EMI or tenure when rates move." }
        },
        {
          "@type": "Question",
          "name": "Is it better to prepay early or late?",
          "acceptedAnswer": { "@type": "Answer", "text": "Earlier prepayments save more interest because they reduce the outstanding balance when interest is the largest share of EMI." }
        },
        {
          "@type": "Question",
          "name": "Which is better: reduce EMI or reduce tenure?",
          "acceptedAnswer": { "@type": "Answer", "text": "Reducing tenure typically lowers total interest more, while reducing EMI improves monthly cash flow. Choose based on your priorities." }
        },
        {
          "@type": "Question",
          "name": "What fees should I check before prepaying?",
          "acceptedAnswer": { "@type": "Answer", "text": "Look for prepayment or foreclosure charges, minimum part-payment amounts, and how quickly the lender updates your schedule." }
        }
      ]
    }
  ]
}
</script>

  <style>
    :root {
      --bg: #f6f9ff;
      --bg-accent1: rgba(14,165,233,0.20);
      --bg-accent2: rgba(16,185,129,0.18);
      --surface: rgba(255,255,255,0.78);
      --surface-strong: rgba(255,255,255,0.92);
      --text: #0f172a;
      --muted: #475569;
      --border: rgba(2,6,23,0.12);
      --accent-1: #0ea5e9;
      --accent-2: #10b981;
      --gradient-solid: linear-gradient(135deg, #10a7e6, #10b981);
      --radius: 16px;
      --shadow: 0 6px 16px rgba(2,6,23,0.08), 0 2px 8px rgba(2,6,23,0.06);
      --maxw: 1200px;

      --input-bg: rgba(255,255,255,0.92);
      --input-focus: rgba(14,165,233,0.25);
      --table-stripe: rgba(2,6,23,0.03);
      --table-head: rgba(2,6,23,0.04);
      --header-h: 72px;
    }

    * { box-sizing: border-box; }
    html, body { width:100%; overflow-x:hidden; }
    body {
      margin: 0;
      font-family: Inter, system-ui, sans-serif;
      color: var(--text);
      background: var(--bg);
      padding-top: 0;
    }
    a { color: inherit; text-decoration: none; }
    .container { max-width: var(--maxw); margin: 0 auto; padding: 0 20px; }

    .glass {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      backdrop-filter: blur(10px) saturate(160%);
      -webkit-backdrop-filter: blur(10px) saturate(160%);
      box-shadow: var(--shadow);
    }

    .topbar {
      position: fixed; top: 0; left: 0; right: 0; z-index: 40;
      background: rgba(255,255,255,0.78);
      border-bottom: 1px solid var(--border);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px) saturate(170%);
      -webkit-backdrop-filter: blur(12px) saturate(170%);
    }
    header.nav {
      display:flex; justify-content:space-between; align-items:center;
      padding: 12px 0;
    }
    .brand-logo { height: 60px; border-radius: 10px; }
    nav.menu { display:flex; gap:14px; }
    nav.menu a {
      padding: 8px 12px;
      border-radius: 10px;
      color: var(--muted);
    }
    nav.menu a:hover {
      background: var(--surface-strong);
      color: var(--text);
    }
    .cta {
      background: var(--gradient-solid);
      color: #fff;
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 600;
    }

    main { padding: 24px 0 60px; }
    .page-title { margin: 16px 0 8px; font-size: 22px; }
    .subtitle { color: var(--muted); font-size: 14px; }

    .layout {
      display:grid;
      grid-template-columns: 2fr 1fr;
      gap: 18px;
      align-items:start;
    }

    .calc { padding: 18px; }
    .grid { display:grid; grid-template-columns: repeat(3,1fr); gap: 12px; }
    .grid-1 { display:grid; grid-template-columns: 1fr; gap: 10px; }
    label { font-size: 12px; color: var(--muted); display:block; margin:0 0 6px; }
    input, select {
      width:100%; padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      outline:none;
    }
    input:focus, select:focus {
      box-shadow: 0 0 0 3px var(--input-focus);
      border-color: transparent;
    }

    .row { display:flex; gap:10px; align-items:center; }
    .chips { display:flex; gap:8px; flex-wrap:wrap; }
    .chip {
      display:flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:12px;
      background: var(--surface-strong);
      border:1px solid var(--border);
    }

    .btn {
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:10px 14px;
      border-radius:12px;
      font-weight:700;
      font-size:13px;
      cursor:pointer;
      border:1px solid var(--border);
      background: var(--surface-strong);
      color: var(--text);
    }
    .btn:hover { background: rgba(2,6,23,0.04); }
    .btn-primary { background: var(--gradient-solid); border: 0; color: #fff; }
    .btn-danger { background: rgba(239,68,68,0.10); color: #b91c1c; border-color: rgba(239,68,68,0.35); }
    .btn-success { background: rgba(16,185,129,0.12); color: #065f46; border-color: rgba(16,185,129,0.35); }

    .summary {
      display:grid;
      grid-template-columns: repeat(4,1fr);
      gap: 12px;
      margin: 12px 0;
    }
    .card {
      padding: 12px 14px;
      border-radius: 14px;
      background: var(--surface);
      border: 1px solid var(--border);
    }
    .small-muted { font-size: 12px; color: var(--muted); }
    .big { font-size: 20px; font-weight: 800; letter-spacing: 0.2px; }

    /* Charts strip */
    .charts-row {
      display:grid;
      grid-template-columns: repeat(2,1fr);
      gap: 12px;
      margin-top: 10px;
    }
    .chart-card {
      position: relative;
      padding: 12px 14px 10px;
      border-radius: 14px;
      background: var(--surface);
      border:1px solid var(--border);
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .chart-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:13px;
      color:var(--muted);
    }
    .chart-title {
      font-weight:600;
      color:var(--text);
    }
    .chart-pill {
      padding:4px 8px;
      border-radius:999px;
      font-size:11px;
      background:rgba(14,165,233,0.08);
      color:#0369a1;
      border:1px solid rgba(14,165,233,0.25);
    }
    .chart-body {
      position:relative;
      flex:1;
      min-height:170px;
    }
    .chart-body canvas {
      width:100% !important;
      height:170px !important;
    }
    .chart-meta {
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:11px;
      color:var(--muted);
      margin-top:2px;
    }
    .dot {
      width:8px; height:8px; border-radius:999px; margin-right:4px;
    }
    .legend-inline {
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
    }
    .legend-item {
      display:inline-flex; align-items:center; font-size:11px; color:var(--muted);
    }

    .table-wrap {
      border-radius: 14px;
      border: 1px solid var(--border);
      overflow: auto;
      max-height: 480px;
      background: rgba(255,255,255,0.5);
      position: relative;
      margin-top: 12px;
    }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    thead th {
      position: sticky; top: 0; z-index: 10;
      background: var(--surface-strong);
      color: var(--muted);
      text-align: right;
      font-weight: 700;
      box-shadow:
        0 1px 0 rgba(2,6,23,0.12) inset,
        0 2px 8px rgba(2,6,23,0.06);
    }
    th, td {
      padding: 10px 10px;
      border-bottom: 1px solid rgba(2,6,23,0.06);
      text-align: right;
    }
    th:first-child, td:first-child { text-align: left; }
    tbody tr:nth-child(odd) { background: var(--table-stripe); }

    .ad-card {
      position: static;
      top: 84px;
      padding: 8px;
      display: grid;
      gap: 12px;
    }
    .ad-slot {
      border: 0px dashed var(--border);
      border-radius: 14px;
      min-height: 250px;
      display: grid;
      place-items: center;
      color: var(--muted);
      background: var(--surface-strong);
    }
    .ad-note { font-size: 12px; color: var(--muted); text-align:center; }

    footer {
      border-top: 1px solid var(--border);
      padding: 30px 0 80px;
      color: var(--muted);
      background: rgba(255,255,255,0.75);
    }

    @media (max-width: 1000px) {
      .layout { grid-template-columns: 1fr; }
      .summary { grid-template-columns: 1fr 1fr; }
      .charts-row { grid-template-columns: 1fr; }
      .ad-card { position: static; }
    }
    @media (max-width: 640px) {
      .summary { grid-template-columns: 1fr; }
      .grid { grid-template-columns: 1fr; }
      .big { font-size: 18px; }
    }

    /* Mobile table -> cards */
    @media (max-width: 600px) {
      table thead { display: none; }
      table, tbody, tr, td { display: block; width: 100%; }
      tr {
        border: 1px solid var(--border);
        border-radius: 12px;
        margin-bottom: 10px;
        padding: 10px;
        background: var(--surface);
      }
      td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 0;
        border: none;
        text-align: left;
        font-size: 13px;
        color: var(--text);
      }
      td[data-label]:before {
        content: attr(data-label) ":";
        font-weight: 600;
        margin-right: 10px;
        color: var(--muted);
        width: 40%;
        max-width: 160px;
      }
      td .value {
        width: 60%;
        text-align: right;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    }

    .mobile-menu-toggle{ display:none; }
    .mobile-menu{ display:none; }

    @media (max-width:768px){
      nav.menu{ display:none; }
      .mobile-menu-toggle{
        display:inline-flex; flex-direction:column; justify-content:center; gap:4px;
        width:28px; height:22px; cursor:pointer; background:transparent; border:0;
      }
      .mobile-menu-toggle span{
        display:block; height:3px; width:100%; background:var(--text); border-radius:2px;
      }
      .mobile-menu{
        display:none; flex-direction:column; gap:6px; padding:10px 0 14px; background:#fff;
        border-bottom:1px solid var(--border);
      }
      .mobile-menu a{
        padding:12px 16px; font-size:15px; color:var(--muted);
      }
      .mobile-menu a:hover{
        background: var(--bg); color: var(--text);
      }

      .ad-card, .ad-slot{ width:100%; }
      .ad-slot ins{
        max-width:100% !important;
        width:100% !important;
        height:auto !important;
        display:block !important;
      }
    }
    .mobile-menu.open{ display:flex !important; }

    /* Footer (glass) */
    footer.glass {
      position: relative; overflow: hidden;
      background: rgba(255,255,255,0.85);
      border-top: 1px solid var(--border);
      backdrop-filter: blur(12px) saturate(170%);
      -webkit-backdrop-filter: blur(12px) saturate(170%);
      box-shadow: 0 -8px 20px rgba(2,6,23,0.06) inset;
      padding: 30px 0 80px;
      color: #475569;
    }
    footer.glass::after {
      content:""; position:absolute; left:0; right:0; top:0; height:2px;
      background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
      opacity:0.8; pointer-events:none;
    }
    /* Mobile nav */
    .mobile-menu-toggle { display:none; }
    .mobile-menu { display:none; }
    @media (max-width: 768px) {
      .topbar { background:#ffffffee; backdrop-filter:none !important; -webkit-backdrop-filter:none !important; }
      .topbar::before, .topbar::after { display:none !important; }
      header.nav { padding:8px 0; }
      .brand-logo { height:48px; border-radius:8px; }
      nav.menu { display:none; }
      .mobile-menu-toggle {
        display:inline-flex; flex-direction:column; justify-content:center;
        gap:4px; width:28px; height:22px; cursor:pointer; background:transparent; border:0;
      }
      .mobile-menu-toggle span {
        display:block; height:3px; width:100%; background:#0f172a; border-radius:2px;
      }
      .mobile-menu {
        display:none; flex-direction:column; gap:6px; padding:10px 0 14px;
        background:#fff; border-bottom:1px solid var(--border);
      }
      .mobile-menu a { padding:12px 16px; font-size:15px; color:#475569; text-decoration:none; }
      .mobile-menu a:hover { background: var(--bg); color: #0f172a; }
    }
    .mobile-menu.open { display:flex !important; }

    /* --- Blog-style typography below calculator --- */
.blog-wrap {
  max-width: 900px;
  margin: 28px auto 60px;
  padding: 0 16px;
}

article.post-article {
  font-size: 17px;
  color: #475569;
  line-height: 1.7;
  max-width: 1074px;
  margin: 0 auto;
}

article.post-article h2 {
  color: var(--accent-2);
  margin-top: 28px;
  margin-bottom: 14px;
  font-weight: 600;
  font-size: 22px;
}

article.post-article h3 {
  color: var(--accent-1);
  margin-top: 20px;
  margin-bottom: 10px;
  font-weight: 600;
  font-size: 18px;
}

article.post-article p {
  margin-bottom: 1.1em;
}

article.post-article ul {
  margin-bottom: 1.1em;
  padding-left: 22px;
}

article.post-article li {
  margin-bottom: 6px;
}

article.post-article hr {
  border: 0;
  border-top: 1px solid rgba(148, 163, 184, 0.4);
  margin: 24px 0;
}

  </style>
</head>
<body>
  <div class="topbar">
    <div class="container">
      <header class="nav" role="banner">
        <a href="/" aria-label="TechFinserv home">
          <img class="brand-logo" src="/images/techfinserv-logo.png" alt="TechFinserv logo">
        </a>

        <nav class="menu" aria-label="Primary">
          <a href="/">Home</a>
          <a href="/blogs/">Blog</a>
          <a href="/coming-soon.html">About</a>
          <a class="cta" href="/coming-soon.html">Apply Now</a>
        </nav>

        <button class="mobile-menu-toggle" aria-label="Toggle menu" aria-expanded="false" aria-controls="mobileMenu">
          <span></span><span></span><span></span>
        </button>
      </header>

      <nav id="mobileMenu" class="mobile-menu" aria-label="Mobile">
        <a href="/">Home</a>
        <a href="/blogs/">Blog</a>
        <a href="/coming-soon.html">Apply Now</a>
      </nav>
    </div>
  </div>

  <main>
    <div class="container">
      <h1 class="page-title">Online EMI Calculator with Part-Payment ‚Äî TechFinserv</h1>
      <p class="subtitle">EMI calculator for home, personal and car loans with part-payment support, instant amortization schedule, and one-click PDF/Excel export.</p>

      <div class="layout">
        <section id="calculator" class="calc glass" role="region" aria-label="EMI Calculator">
          <div class="grid" style="margin-bottom:12px;">
            <div>
              <label>Loan Amount (Principal)</label>
              <input id="loan" type="number" min="1" value="100000" />
            </div>
            <div>
              <label>Annual Interest Rate (%)</label>
              <input id="rate" type="number" step="0.01" min="0" value="12.50" />
            </div>
            <div>
              <label>Tenure (Years)</label>
              <input id="years" type="number" step="0.25" min="0.1" value="5" />
            </div>
          </div>

          <div style="display:flex; gap:12px; align-items:flex-end; flex-wrap:wrap; margin-bottom:10px;">
            <div style="min-width:220px;">
              <label>Mode</label>
              <select id="mode">
                <option value="tenure">Reduce Tenure (EMI fixed)</option>
                <option value="emi">Reduce EMI (Tenure fixed)</option>
              </select>
            </div>

            <div style="flex:1; min-width:260px;">
              <label>Add Part Payment (Month & Amount)</label>
              <div class="row">
                <input id="ppMonth" type="number" min="1" placeholder="Month (e.g. 12)" style="max-width:140px" />
                <input id="ppAmount" type="number" min="0" placeholder="Amount (e.g. 100000)" />
                <button id="addPp" class="btn btn-primary" type="button">Add</button>
                <button id="clearPps" class="btn btn-danger" type="button">Clear</button>
              </div>
            </div>
          </div>

          <div style="margin:10px 0 6px;">
            <div class="small-muted">Part Payments (click remove to delete):</div>
            <div id="paymentsList" class="chips" style="margin-top:8px;"></div>
          </div>

          <div class="summary" id="dashboard">
            <div class="card">
              <div class="small-muted">Initial EMI</div>
              <div id="initialEmi" class="big">0</div>
              <div class="small-muted">before prepayment</div>
            </div>
            <div class="card">
              <div class="small-muted">New Tenure (months)</div>
              <div id="newMonths" class="big">0</div>
            </div>
            <div class="card">
              <div class="small-muted">Total Interest Paid</div>
              <div id="totalInterest" class="big">0</div>
            </div>
            <div class="card">
              <div class="small-muted">Total Payment</div>
              <div id="totalPayment" class="big">0</div>
            </div>
          </div>

          <!-- Charts row -->
          <div class="charts-row">
            <div class="chart-card">
              <div class="chart-header">
                <span class="chart-title">Normal Loan Split</span>
                <span class="chart-pill">No Part Payment</span>
              </div>
              <div class="chart-body">
                <canvas id="chartNormal"></canvas>
              </div>
              <div class="chart-meta">
                <div class="legend-inline">
                  <div class="legend-item">
                    <span class="dot" style="background:#0ea5e9;"></span>Interest
                  </div>
                  <div class="legend-item">
                    <span class="dot" style="background:#22c55e;"></span>Principal
                  </div>
                </div>
                <span class="small-muted">Helps you see cost of interest without prepayments</span>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-header">
                <span class="chart-title">With Part Payment</span>
                <span class="chart-pill" id="ppStatusBadge">After Pre-Payments</span>
              </div>
              <div class="chart-body">
                <canvas id="chartWithPP"></canvas>
              </div>
              <div class="chart-meta">
                <div class="legend-inline">
                  <div class="legend-item">
                    <span class="dot" style="background:#22c55e;"></span>Principal
                  </div>
                  <div class="legend-item">
                    <span class="dot" style="background:#0ea5e9;"></span>Interest
                  </div>
                  <div class="legend-item">
                    <span class="dot" style="background:#f97316;"></span>Interest Saved
                  </div>
                </div>
                <span class="small-muted">Compare total interest vs savings from prepayments</span>
              </div>
            </div>
          </div>

          <div class="glass" style="padding:14px; margin-top:12px;">
            <div class="row" style="justify-content: space-between; align-items:center; margin-bottom:8px; flex-wrap:wrap;">
              <strong>Repayment Schedule</strong>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button id="downloadXLSX" class="btn btn-success" type="button">Download Excel</button>
                <button id="downloadPDF" class="btn" type="button">Download PDF</button>
              </div>
            </div>
            <div class="table-wrap">
              <table id="scheduleTable">
                <thead>
                  <tr><th>Month</th><th>EMI</th><th>Principal</th><th>Interest</th><th>Part Payment</th><th>Outstanding</th></tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <p class="small-muted" style="margin-top:10px;">
            Tip: add one or more part payments (month number & amount). Choose <em>Reduce Tenure</em> to keep EMI the same (loan closes earlier),
            or <em>Reduce EMI</em> to keep tenure same and reduce monthly payment. Save the file to keep your data.
          </p>
        </section>

        <aside class="ad-card glass" aria-label="Ad">
          <div class="ad-slot" style="min-height:600px;">
            <ins class="adsbygoogle"
                 style="display:inline-block;width:300px;height:600px"
                 data-ad-client="ca-pub-4180233192929131"
                 data-ad-slot="9154021274"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
          </div>

          <div class="ad-slot" style="min-height:555px;">
            <ins class="adsbygoogle"
                 style="display:inline-block;width:300px;height:500px"
                 data-ad-client="ca-pub-4180233192929131"
                 data-ad-slot="2241854911"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
          </div>

          <div class="ad-note">Support ‚ù§Ô∏è Us By Clicking Ads</div>
        </aside>
      </div>      
    </div>
   
          <!-- Blog-style explanation below calculator -->
       <section id="learn-emi" class="glass" style="margin-top:20px; padding:18px;">
        <article class="post-article">
        <h2 style="margin-top:18px;">How to use this calculator</h2>
        <ol style="margin:0 0 0 18px; padding:0;">
          <li>Enter <strong>Loan Amount</strong>, <strong>Annual Interest</strong>, and <strong>Tenure</strong>.</li>
          <li>Choose a mode:
            <ul style="margin:6px 0 0 16px;">
              <li><strong>Reduce Tenure</strong> ‚Äî EMI stays same; prepayments shorten the loan.</li>
              <li><strong>Reduce EMI</strong> ‚Äî Tenure stays same; prepayments lower the EMI.</li>
            </ul>
          </li>
          <li>(Optional) Add <strong>Part Payments</strong> by month and amount. You can add multiple entries.</li>
        </ol>
        <p class="small-muted" style="margin-top:8px;">
          The schedule table shows the month-wise split of principal and interest, any prepayments, and the updated outstanding balance.
        </p>

        <h3 style="margin:16px 0 8px;">Floating / Variable Rate Planning</h3>
        <p>If your loan has a floating rate, test both directions to stay prepared:</p>
        <ul style="margin:0 0 0 18px; padding:0;">
          <li><strong>Optimistic case:</strong> Rate falls by 1‚Äì3%. EMI may drop (or you can keep EMI same and finish sooner).</li>
          <li><strong>Pessimistic case:</strong> Rate rises by 1‚Äì3%. Check if your cash flow can still handle the EMI comfortably.</li>
        </ul>
        <p class="small-muted" style="margin-top:8px;">
          Try a few ‚Äúwhat-if‚Äù runs in the calculator to decide a safe EMI and sensible tenure for your situation.
        </p>

        <h3 style="margin:16px 0 8px;">FAQs</h3>
        <details>
          <summary><strong>Does EMI change every month?</strong></summary>
          <p>For fixed-rate loans, the EMI amount stays constant, but the interest/principal split shifts over time. For floating-rate loans, the lender may change EMI or tenure when rates move.</p>
        </details>
        <details>
          <summary><strong>Is it better to prepay early or late?</strong></summary>
          <p>Earlier prepayments save more interest because they reduce the outstanding when interest is the largest share of EMI.</p>
        </details>
        <details>
          <summary><strong>Which is better: reduce EMI or reduce tenure?</strong></summary>
          <p>Reducing tenure usually cuts total interest more. Reducing EMI improves monthly cash flow‚Äîpick what suits your goals.</p>
        </details>
        <details>
          <summary><strong>What fees should I check before prepaying?</strong></summary>
          <p>Look for prepayment/foreclosure charges, minimum part-payment amounts, and how quickly the lender updates your schedule.</p>
        </details>

        <h3 style="margin:16px 0 8px;">Glossary</h3>
        <ul style="margin:0 0 0 18px; padding:0;">
          <li><strong>Principal:</strong> Original loan amount borrowed.</li>
          <li><strong>Interest:</strong> Cost of borrowing, charged on the outstanding balance.</li>
          <li><strong>Tenure:</strong> Total time to repay the loan, in months/years.</li>
          <li><strong>Prepayment / Part-payment:</strong> Extra payments made to reduce the outstanding sooner.</li>
          <li><strong>Amortization:</strong> Gradual repayment of principal over time through EMIs.</li>
        </ul>        

        <!-- Font Awesome Icons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">


    <h2><i class="fas fa-calculator"></i> What is EMI?</h2>
    <p>
        EMI (Equated Monthly Instalment) is the fixed amount you pay every month to repay your loan. 
        Every EMI includes two parts ‚Äî <strong>Principal</strong> and <strong>Interest</strong>. 
        Most banks calculate EMI using the <strong>reducing balance method</strong>, where interest is charged 
        only on the remaining loan amount. This helps borrowers plan their monthly budget easily.
    </p>

    <h2><i class="fas fa-percent"></i> Types of Interest Rates</h2>

    <h3><i class="fas fa-lock"></i> Fixed Interest Rate</h3>
    <p>
        This rate remains constant throughout the loan tenure. Your EMI never changes, making it a stable 
        and predictable option for loans like personal loans and car loans.
    </p>

    <h3><i class="fas fa-arrows-rotate"></i> Floating / Variable Interest Rate</h3>
    <p>
        Floating rates change based on market conditions and RBI repo rate. Your EMI may increase or decrease. 
        This is common in <strong>home loans</strong>.
    </p>

    <h3><i class="fas fa-chart-line"></i> Reducing Balance Interest Rate</h3>
    <p>
        Interest is calculated on the outstanding principal each month. As the principal decreases, 
        interest also reduces. This method is more cost-effective and widely used in home loans.
    </p>

    <h3><i class="fas fa-money-bill"></i> Flat Interest Rate</h3>
    <p>
        Interest is charged on the full loan amount for the entire tenure, even though the principal 
        reduces over time. This increases the total interest cost and is common in small loans.
    </p>

    <hr style="margin:25px 0;">

    <h2><i class="fas fa-house"></i> Home Loan EMI</h2>
    <p>
        Home loan EMIs are typically long-term and depend on loan amount, interest rate, and tenure. 
        Banks mostly use the <strong>floating interest rate</strong> system for home loans. 
        Calculating your home loan EMI helps you estimate affordability and plan repayment better.
    </p>

    <h2><i class="fas fa-car"></i> Car Loan EMI</h2>
    <p>
        Car loans usually come with <strong>fixed interest rates</strong>. This keeps your EMI the same 
        every month, making it easier to manage vehicle purchase planning.
    </p>

    <h2><i class="fas fa-user"></i> Personal Loan EMI</h2>
    <p>
        Personal loans come with higher interest rates compared to home and car loans. EMI depends on 
        credit score, income, and loan amount. The reducing balance method is normally used to calculate 
        personal loan EMIs.
    </p>

    <hr style="margin:25px 0;">

    <h2><i class="fas fa-lightbulb"></i> Why EMI Calculation is Important?</h2>
    <ul>
        <li>Helps plan monthly finances</li>
        <li>Allows comparison of different loan offers</li>
        <li>Shows total interest payable</li>
        <li>Helps choose the right tenure</li>
        <li>Reduces chances of financial stress</li>
    </ul>

        </article>
      </section>
    </div>
  </main>

 

<!-- ====== Footer social icons END ====== -->
<style>
footer.glass .social {
  display:flex; gap:10px; align-items:center; margin:12px 0;
}
footer.glass .social a{
  width:34px;height:34px;display:inline-flex;align-items:center;justify-content:center;
  border-radius:10px;background:#fff;border:1px solid rgba(2,6,23,.10);
  box-shadow:0 4px 10px rgba(2,6,23,.06);
  text-decoration:none; transition:transform .15s ease,border-color .2s ease;
}
footer.glass .social a:hover{ transform:translateY(-2px); border-color:#0ea5e950; }
footer.glass .social svg{ width:18px;height:18px; display:block; }
footer.glass .social .fb svg{ fill:#1877F2; }
footer.glass .social .ig svg{ fill:#E1306C; }
footer.glass .social .ln svg{ fill:#0A66C2; }
footer.glass .social .x  svg{ fill:#111; }
footer.glass .social .yt svg{ fill:#FF0000; }
footer.glass .social .wa svg{ fill:#25D366; }
</style>
<!-- ====== Footer social icons END ====== -->

  <!-- ====== FOOTER (replaced with Coming Soon footer) ====== -->
  <footer id="contact" class="glass">
    <div class="container">      
      <div class="social" aria-label="Social links">
      <a class="fb" href="https://www.facebook.com/profile.php?id=61583100667662" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22 12.06C22 6.48 17.52 2 11.94 2 6.36 2 1.88 6.48 1.88 12.06c0 4.88 3.56 8.93 8.22 9.8v-6.93H7.9v-2.87h2.2V9.6c0-2.18 1.3-3.39 3.3-3.39.96 0 1.97.17 1.97.17v2.16h-1.11c-1.1 0-1.44.69-1.44 1.4v1.68h2.45l-.39 2.87h-2.06v6.93c4.66-.87 8.22-4.92 8.22-9.8z"/></svg>
      </a>
      <a class="ig" href="https://www.instagram.com/techfinserv/" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5A5.5 5.5 0 1 1 6.5 13 5.51 5.51 0 0 1 12 7.5zm0 2A3.5 3.5 0 1 0 15.5 13 3.5 3.5 0 0 0 12 9.5zm5.75-2.75a1.25 1.25 0 1 1-1.25 1.25 1.25 1.25 0 0 1 1.25-1.25z"/></svg>
      </a>
      <a class="ln" href="https://www.linkedin.com/company/techfinserv" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M19 3A2.94 2.94 0 0 1 22 6v12a2.94 2.94 0 0 1-3 3H5a2.94 2.94 0 0 1-3-3V6a2.94 2.94 0 0 1 3-3Zm-9.65 7H6.08v8h3.27Zm.23-2.93a1.86 1.86 0 1 0-1.87 1.86 1.86 1.86 0 0 0 1.87-1.86ZM21 18v-4.27c0-3.06-1.63-4.48-3.81-4.48a3.28 3.28 0 0 0-3 1.65h-.06V10H11v8h3.27v-4.44c0-1.17.22-2.31 1.68-2.31S17.6 12.33 17.6 13.6V18Z"/></svg>
      </a>
      <a class="x" href="https://x.com/TechFinservIN" target="_blank" rel="noopener noreferrer" aria-label="X (Twitter)">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 3h4.6l5.17 6.96L16.8 3H21l-7.54 9.9L21.3 21h-4.6l-5.5-7.4L7.2 21H2l7.83-10.25z"/></svg>
      </a>
      <a class="yt" href="https://www.youtube.com/@TechFinservYT" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M23.5 6.2s-.23-1.65-.95-2.37c-.9-.95-1.92-.96-2.38-1C16.9 2.4 12 2.4 12 2.4h-.01s-4.9 0-8.17.43c-.46.05-1.48.06-2.38 1C.73 4.55.5 6.2.5 6.2S.27 8.22.27 10.24v1.52c0 2.02.23 4.04.23 4.04s.23 1.65.95 2.37c.9.95 2.08.92 2.61 1.02 1.9.18 7.94.43 7.94.43s4.9 0 8.17-.43c.46-.05 1.48-.06 2.38-1 .72-.72.95-2.37.95-2.37s.23-2.02.23-4.04v-1.52c0-2.02-.23-4.04-.23-4.04ZM9.75 14.41V7.59l6.34 3.41-6.34 3.41Z"/></svg>
      </a>
      <a class="wa" href="https://wa.me/919054356860" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M20.52 3.48A11.8 11.8 0 0 0 12.03 0 11.97 11.97 0 0 0 1.8 17.7L0 24l6.45-1.7A11.96 11.96 0 0 0 12.03 24h.01A11.97 11.97 0 0 0 24 12.02a11.8 11.8 0 0 0-3.48-8.54ZM12.04 21.5h-.01a9.45 9.45 0 0 1-4.83-1.32l-.35-.2-3.83 1.01 1.02-3.73-.22-.38a9.48 9.48 0 1 1 8.22 4.62Zm5.49-7.17c-.3-.15-1.78-.88-2.06-.98-.28-.1-.48-.15-.68.15s-.78.98-.96 1.18-.35.22-.64.08a7.73 7.73 0 0 1-2.28-1.41 8.57 8.57 0 0 1-1.58-1.96c-.17-.3 0-.46.13-.62.13-.15.3-.38.45-.58.15-.2.2-.35.3-.58.1-.22.05-.42-.03-.58-.08-.15-.68-1.63-.93-2.23-.24-.6-.5-.5-.68-.5h-.58c-.2 0-.52.08-.8.38-.28.3-1.06 1.03-1.06 2.5s1.09 2.9 1.24 3.11c.15.2 2.14 3.25 5.19 4.55.73.32 1.3.51 1.74.65.73.23 1.4.2 1.93.12.59-.09 1.78-.73 2.03-1.43.25-.7.25-1.3.17-1.43-.08-.13-.28-.2-.58-.35Z"/></svg>
      </a>
    </div>
     
    <p class="subtitle" style="font-size:13px">Need something urgently? <a href="mailto:techfinserv.com@gmail.com">support@techfinserv.com</a></p>
    <p>Designed & Maintained by Kiran Rathva | ¬© <span id="year"></span> TechFinserv.com</p>
  </div>
</footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    (function(){
      const topbar = document.querySelector('.topbar');
      if(!topbar) return;
      const setPad = () => { document.body.style.paddingTop = topbar.offsetHeight + 'px'; };
      setPad();
      window.addEventListener('resize', setPad, { passive: true });
    })();

    (function () {
      const toggle = document.querySelector('.mobile-menu-toggle');
      const menu = document.getElementById('mobileMenu');
      if (!toggle || !menu) return;

      const setExpanded = (open) => {
        toggle.setAttribute('aria-expanded', String(open));
        menu.classList.toggle('open', open);
      };

      toggle.addEventListener('click', () => {
        const open = !menu.classList.contains('open');
        setExpanded(open);
      }, { passive: true });

      menu.addEventListener('click', (e) => {
        if (e.target.tagName === 'A') setExpanded(false);
      }, { passive: true });

      const onResize = () => {
        if (window.innerWidth > 768) setExpanded(false);
      };
      window.addEventListener('resize', onResize, { passive: true });
    })();

    const fmt = (v) => {
      const n = Math.round(Number(v) || 0);
      return new Intl.NumberFormat('en-IN', { maximumFractionDigits: 0, minimumFractionDigits: 0 }).format(n);
    };

    function pmt(rate, nper, pv) {
      if (nper === 0) return 0;
      if (Math.abs(rate) < 1e-12) return pv / nper;
      return (pv * rate) / (1 - Math.pow(1 + rate, -nper));
    }

    const loanEl = document.getElementById('loan');
    const rateEl = document.getElementById('rate');
    const yearsEl = document.getElementById('years');
    const modeEl = document.getElementById('mode');

    const ppMonthEl = document.getElementById('ppMonth');
    const ppAmountEl = document.getElementById('ppAmount');
    const paymentsList = document.getElementById('paymentsList');

    const initialEmiEl = document.getElementById('initialEmi');
    const newMonthsEl = document.getElementById('newMonths');
    const totalInterestEl = document.getElementById('totalInterest');
    const totalPaymentEl = document.getElementById('totalPayment');

    const scheduleTbody = document.querySelector('#scheduleTable tbody');
    const downloadXLSXBtn = document.getElementById('downloadXLSX');
    const downloadPDFBtn = document.getElementById('downloadPDF');

    const ppStatusBadge = document.getElementById('ppStatusBadge');

    let payments = [];

    function getInputs() {
      const principal = Math.max(1, Math.round(Number(loanEl.value) || 1));
      const annualRate = Math.max(0, Number(rateEl.value) || 0);
      const tenureYears = Math.max(0.1, Number(yearsEl.value) || 0.1);
      return {
        principal,
        annualRate,
        tenureYears,
        monthlyRate: annualRate / 12 / 100,
        monthsInitial: Math.round(Math.max(1, tenureYears * 12))
      };
    }

    function renderPayments() {
      if (payments.length === 0) {
        paymentsList.innerHTML = '<div class="small-muted">No part payments added.</div>';
        return;
      }
      let html = '';
      payments.forEach((p, idx) => {
        html += '<div class="chip">' +
          '<div class="small-muted">' +
            'Month ' + p.month + ' (' + (p.mode === "emi" ? "Reduce EMI" : "Reduce Tenure") + ') ‚Üí ' +
            '<strong>' + fmt(p.amount) + '</strong>' +
          '</div>' +
          '<button data-rm="' + idx + '" class="btn btn-danger" style="padding:6px 10px">Remove</button>' +
        '</div>';
      });
      paymentsList.innerHTML = html;
      paymentsList.querySelectorAll('button[data-rm]').forEach(btn => {
        btn.onclick = () => {
          payments.splice(Number(btn.getAttribute('data-rm')), 1);
          renderPayments();
          scheduleDirty = true;
          scheduleRAF();
        };
      });
    }

    function addPayment() {
      const m = Math.max(1, Math.round(Number(ppMonthEl.value) || 0));
      const a = Math.max(0, Math.round(Number(ppAmountEl.value) || 0));
      if (!a) { alert('Please enter a part payment amount > 0'); return; }
      payments.push({ month: m, amount: a, mode: modeEl.value }); // store mode per payment
      payments.sort((x, y) => x.month - y.month);
      ppMonthEl.value = '';
      ppAmountEl.value = '';
      renderPayments();
      scheduleDirty = true;
      scheduleRAF();
    }

    function clearPayments() {
      if (!confirm('Clear all part payments?')) return;
      payments = [];
      renderPayments();
      scheduleDirty = true;
      scheduleRAF();
    }

    function computeSchedule(usePayments = true) {
  const { principal, monthlyRate, monthsInitial } = getInputs();
  const initialEmi = Math.abs(pmt(monthlyRate, monthsInitial, principal));

  // Build maps per month: total part amount + effective mode
  const partMap = new Map();   // month -> total amount
  const modeMap = new Map();   // month -> "tenure" or "emi"

  if (usePayments) {
    for (const p of payments) {
      const m = p.month;
      const amt = p.amount || 0;
      const mMode = p.mode || "tenure"; // default safety

      // sum part-payments for same month
      partMap.set(m, (partMap.get(m) || 0) + amt);

      // if multiple payments in same month, "emi" wins
      if (!modeMap.has(m)) {
        modeMap.set(m, mMode);
      } else {
        const existing = modeMap.get(m);
        if (existing === "tenure" && mMode === "emi") {
          modeMap.set(m, "emi");
        }
      }
    }
  }

  const schedule = [];
  let outstanding = principal;
  let emi = initialEmi;
  let remainingMonths = monthsInitial;

  for (let month = 1; month <= 1200; month++) {
    if (outstanding <= 0.0001) break;

    const interest = outstanding * monthlyRate;
    let principalComp = emi - interest;
    if (principalComp < 0) principalComp = 0;

    const part = partMap.get(month) || 0;
    const thisMonthMode = modeMap.get(month) || "tenure";

    // If this is the final month (including part payment), close loan cleanly
    if (outstanding - principalComp - part <= 0) {
      const finalInterest = outstanding * monthlyRate;
      const finalPrincipal = outstanding;
      const finalEmi = finalPrincipal + finalInterest;

      schedule.push({
        month,
        emi: Math.round(finalEmi),
        principalPaid: Math.round(finalPrincipal),
        interestPaid: Math.round(finalInterest),
        partPayment: Math.round(part),
        outstanding: 0
      });

      outstanding = 0;
      break;
    }

    // Normal month: subtract EMI principal + part-payment
    outstanding = outstanding - principalComp - part;

    // üîÅ Recalculate EMI ONLY if this payment's mode is "emi"
    if (thisMonthMode === "emi" && part > 0 && usePayments) {
      remainingMonths = Math.max(1, monthsInitial - month);
      if (outstanding > 0) {
        emi = Math.abs(pmt(monthlyRate, remainingMonths, outstanding));
      }
    }

    schedule.push({
      month,
      emi: Math.round(emi),
      principalPaid: Math.round(principalComp),
      interestPaid: Math.round(interest),
      partPayment: Math.round(part),
      outstanding: Math.round(Math.max(0, outstanding))
    });

    if (month > monthsInitial + 600) break;
  }

  return { schedule, initialEmi: Math.round(initialEmi) };
}


    function renderSchedule(schedule) {
      let rows = '';
      for (let i = 0; i < schedule.length; i++) {
        const r = schedule[i];
        rows += '\n<tr>' +
          '<td data-label="Month"><span class="value">' + r.month + '</span></td>' +
          '<td data-label="EMI"><span class="value">' + fmt(r.emi) + '</span></td>' +
          '<td data-label="Principal"><span class="value">' + fmt(r.principalPaid) + '</span></td>' +
          '<td data-label="Interest"><span class="value">' + fmt(r.interestPaid) + '</span></td>' +
          '<td data-label="Part Payment"><span class="value">' + fmt(r.partPayment) + '</span></td>' +
          '<td data-label="Outstanding"><span class="value">' + fmt(r.outstanding) + '</span></td>' +
        '</tr>';
      }
      scheduleTbody.innerHTML = rows;
    }

    function updateKpis(schedule, initialEmi) {
      const totalInterest = schedule.reduce((s, r) => s + r.interestPaid, 0);
      const principalInput = Math.max(1, Math.round(Number(loanEl.value) || 1));
      const totalPayment = totalInterest + principalInput;

      initialEmiEl.textContent = fmt(initialEmi);
      newMonthsEl.textContent = schedule.length;
      totalInterestEl.textContent = fmt(totalInterest);
      totalPaymentEl.textContent = fmt(totalPayment);
    }

    // ---- Charts setup ----
    let chartNormal = null;
    let chartWithPP = null;

    function initCharts() {
      const ctxNormal = document.getElementById('chartNormal').getContext('2d');
      const ctxPP = document.getElementById('chartWithPP').getContext('2d');

      const baseOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: 'rgba(15,23,42,0.94)',
            titleColor: '#e5e7eb',
            bodyColor: '#e5e7eb',
            borderColor: 'rgba(148,163,184,0.4)',
            borderWidth: 1,
            padding: 8,
            callbacks: {
              label: function(ctx) {
                const label = ctx.label || '';
                const value = ctx.raw || 0;
                return label + ': ' + fmt(value);
              }
            }
          }
        },
        cutout: '68%',
        animation: { duration: 450, easing: 'easeOutCubic' }
      };

      chartNormal = new Chart(ctxNormal, {
        type: 'doughnut',
        data: {
          labels: ['Interest', 'Principal'],
          datasets: [{
            data: [0, 0],
            backgroundColor: ['#0ea5e9', '#22c55e'],
            borderWidth: 0
          }]
        },
        options: baseOptions
      });

      chartWithPP = new Chart(ctxPP, {
        type: 'doughnut',
        data: {
          labels: ['Principal', 'Interest', 'Interest Saved'],
          datasets: [{
            data: [0, 0, 0],
            backgroundColor: ['#22c55e', '#0ea5e9', '#f97316'],
            borderWidth: 0
          }]
        },
        options: baseOptions
      });
    }

    function updateCharts(currentSchedule) {
      if (!chartNormal || !chartWithPP) return;

      const principal = Math.max(1, Math.round(Number(loanEl.value) || 1));

      const baseline = computeSchedule(false).schedule;
      const baselineInterest = baseline.reduce((s, r) => s + r.interestPaid, 0);

      const currentInterest = currentSchedule.reduce((s, r) => s + r.interestPaid, 0);
      const interestSavedRaw = baselineInterest - currentInterest;
      const interestSaved = Math.max(0, Math.round(interestSavedRaw));

      // Normal loan chart
      chartNormal.data.datasets[0].data = [baselineInterest, principal];
      chartNormal.update();

      // With part-payment chart
      const hasPP = payments.some(p => p.amount && p.amount > 0);
      ppStatusBadge.textContent = hasPP ? 'Part payments applied' : 'No part payments';

      chartWithPP.data.datasets[0].data = [principal, currentInterest, interestSaved];
      chartWithPP.update();
    }

    function computeAndRender() {
      const { schedule, initialEmi } = computeSchedule(true);
      renderSchedule(schedule);
      updateKpis(schedule, initialEmi);
      lastSchedule = schedule;
      lastInitialEmi = initialEmi;
      updateCharts(schedule);
    }

    let scheduleDirty = false;
    let rafId = 0;
    let lastSchedule = null;
    let lastInitialEmi = 0;

    function scheduleRAF() {
      if (rafId) return;
      rafId = requestAnimationFrame(() => {
        rafId = 0;
        if (scheduleDirty) {
          scheduleDirty = false;
          computeAndRender();
        }
      });
    }

    document.getElementById('addPp').addEventListener('click', addPayment);
    document.getElementById('clearPps').addEventListener('click', clearPayments);

    const onInput = () => { scheduleDirty = true; scheduleRAF(); };
    [loanEl, rateEl, yearsEl, modeEl].forEach(el => el.addEventListener('input', onInput));

    function exportXLSX() {
      const schedule = lastSchedule || computeSchedule(true).schedule;
      const hasPart = payments.some(p => p.amount && p.amount > 0);
      const aoa = [
       ['Loan Amount', loanEl.value],
       ['Annual Rate (%)', rateEl.value],
       ['Tenure (Years)', yearsEl.value],
       ['Mode', payments.length ? 'Per Part Payment' : 'Normal (No Part Payment)'],
       [],
       ];
      if (hasPart) {
        aoa.push(['Month','EMI','Principal Paid','Interest Paid','Part Payment','Outstanding']);
        schedule.forEach(r => aoa.push([r.month, r.emi, r.principalPaid, r.interestPaid, r.partPayment, r.outstanding]));
      } else {
        aoa.push(['Month','EMI','Principal Paid','Interest Paid','Outstanding']);
        schedule.forEach(r => aoa.push([r.month, r.emi, r.principalPaid, r.interestPaid, r.outstanding]));
      }
      const ws = XLSX.utils.aoa_to_sheet(aoa);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Schedule');
      const wbout = XLSX.write(wb, {bookType:'xlsx', type:'array'});
      try { saveAs(new Blob([wbout],{type:"application/octet-stream"}), 'emi_schedule.xlsx'); }
      catch(e) { alert('Excel export failed: ' + e.message); }
    }

function exportPDF() {
  const result = lastSchedule ? { schedule: lastSchedule, initialEmi: lastInitialEmi } : computeSchedule(true);
  const scheduleData = result.schedule;
  const initialEmi = result.initialEmi;

  const loan = Math.round(Number(loanEl.value) || 0);
  const rate = Number(rateEl.value) || 0;
  const years = Number(yearsEl.value) || 0;
  const principal = loan;

  const totalInterest = scheduleData.reduce((s, r) => s + r.interestPaid, 0);
  const totalPayment = principal + totalInterest;

  const hasPart = payments.some(p => p.amount && p.amount > 0);

  // Baseline (no prepayment) interest -> interest saved
  const baseline = computeSchedule(false).schedule;
  const baselineInterest = baseline.reduce((s, r) => s + r.interestPaid, 0);
  const rawSaved = baselineInterest - totalInterest;
  const interestSaved = Math.max(0, Math.round(rawSaved));

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "pt", format: "a4" });

  const pageW = doc.internal.pageSize.getWidth();
  const pageH = doc.internal.pageSize.getHeight();
  const margin = 40;

  // ---------- PAGE BACKGROUND ----------
  doc.setFillColor(246, 249, 255);
  doc.rect(0, 0, pageW, pageH, "F");

  doc.setFillColor(230, 242, 255);
  doc.rect(0, 0, pageW, 70, "F");

  // ---------- TITLE ----------
  doc.setFont("helvetica", "bold");
  doc.setFontSize(18);
  doc.setTextColor(15, 23, 42);
  doc.text("Amortization Schedule", margin, 40);

  doc.setFont("helvetica", "normal");
  doc.setFontSize(10);
  doc.setTextColor(71, 85, 105);
  doc.text("Loan summary with part-payment & amortization schedule", margin, 56);

  // ---------- MAIN CARD (LEFT BLUE SUMMARY) ----------
  const cardX = margin;
  const cardY = 90;
  const cardH = 230;
  const cardW = pageW - margin * 2;
  const leftW = cardW * 0.5;

  // dark navy block
  doc.setFillColor(5, 37, 66);
  doc.roundedRect(cardX, cardY, leftW, cardH, 18, 18, "F");
  doc.setDrawColor(15, 118, 178);
  doc.roundedRect(cardX, cardY, leftW, cardH, 18, 18, "S");

  // heading
  doc.setTextColor(255, 255, 255);
  doc.setFont("helvetica", "bold");
  doc.setFontSize(12);
  doc.text("TechFinserv", cardX + 18, cardY + 22);

  doc.setFont("helvetica", "normal");
  doc.setFontSize(9);
  doc.setTextColor(191, 219, 254);
  doc.text("Smart EMI & part-payment planner", cardX + 18, cardY + 38);

  // helper for centered field boxes
  function drawFieldBox(row, col, label, value) {
    const cols = 3;
    const padX = 18;
    const padY = 60;
    const gapX = 10;
    const gapY = 12;
    const totalInnerW = leftW - padX * 2 - gapX * (cols - 1);
    const boxW = totalInnerW / cols;
    const boxH = 54;

    const x = cardX + padX + col * (boxW + gapX);
    const y = cardY + padY + row * (boxH + gapY);

    // blue inner box
    doc.setFillColor(24, 77, 112);
    doc.roundedRect(x, y, boxW, boxH, 12, 12, "F");
    doc.setDrawColor(59, 130, 246);
    doc.roundedRect(x, y, boxW, boxH, 12, 12, "S");

    // label (centered, auto-wrap)
    doc.setTextColor(226, 232, 240);
    doc.setFont("helvetica", "bold");
    doc.setFontSize(8);

    const labelLines = doc.splitTextToSize(label, boxW - 16);
    const labelY = y + 14;
    doc.text(labelLines, x + boxW / 2, labelY, { align: "center" });

    // value (centered)
    doc.setFont("helvetica", "bold");
    doc.setFontSize(13);
    const valueY = y + boxH - 10;
    doc.text(value, x + boxW / 2, valueY, { align: "center" });
  }

  // row 1
  drawFieldBox(0, 0, "Loan Amount", fmt(principal));
  drawFieldBox(0, 1, "Interest Rate (%)", String(rate));
  drawFieldBox(0, 2, "Tenure (yrs)", String(years));

  // row 2
  drawFieldBox(1, 0, "Total Interest Paid", fmt(totalInterest));
  drawFieldBox(1, 1, "Total Payment", fmt(totalPayment));
  drawFieldBox(1, 2, "EMI", fmt(initialEmi));

  // ---------- RIGHT CARD + CUSTOM PIE CHART ----------
  const pieCardX = cardX + leftW + 30;
  const pieCardY = cardY + 6;
  const pieCardW = cardW - leftW - 30;
  const pieCardH = cardH - 12;

  // white card
  doc.setFillColor(255, 255, 255);
  doc.roundedRect(pieCardX, pieCardY, pieCardW, pieCardH, 20, 20, "F");
  doc.setDrawColor(226, 232, 240);
  doc.roundedRect(pieCardX, pieCardY, pieCardW, pieCardH, 20, 20, "S");

  // title + subtitle
  doc.setFont("helvetica", "bold");
  doc.setFontSize(11);
  doc.setTextColor(15, 23, 42);
  doc.text("Loan Split with Part Payments", pieCardX + 18, pieCardY + 22);

  doc.setFont("helvetica", "normal");
  doc.setFontSize(8);
  doc.setTextColor(107, 114, 128);
  doc.text(
    hasPart
      ? "Principal, interest & interest saved after pre-payments"
      : "No part payments added ‚Äì normal loan split",
    pieCardX + 18,
    pieCardY + 36
  );

  // ---- custom pie chart + legend (ALL inside this card) ----
  (function () {
    const canvas = document.createElement("canvas");
    const size = 260;
    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext("2d");

    const cx = size / 2;
    const cy = size / 2;
    const radius = 110;

    const values = [principal, totalInterest, interestSaved];
    const colors = ["#0b5ed7", "#f97316", "#22c55e"]; // blue, orange, green

    const total = values.reduce((a, b) => a + (b > 0 ? b : 0), 0) || 1;
    let startAngle = -Math.PI / 2;

    for (let i = 0; i < values.length; i++) {
      const v = values[i];
      if (v <= 0) continue;          // skip 0 slices
      const sliceAngle = (v / total) * Math.PI * 2;

      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.arc(cx, cy, radius, startAngle, startAngle + sliceAngle);
      ctx.closePath();
      ctx.fillStyle = colors[i];
      ctx.fill();

      startAngle += sliceAngle;
    }

    // soft outline
    ctx.beginPath();
    ctx.arc(cx, cy, radius, 0, Math.PI * 2);
    ctx.lineWidth = 4;
    ctx.strokeStyle = "rgba(15,23,42,0.1)";
    ctx.stroke();

    const imgData = canvas.toDataURL("image/png");

    // keep chart + legend fully inside card
    const innerTop = pieCardY + 48;               // below title
    const chartSize = 120;
    const chartY = innerTop;
    const chartX = pieCardX + (pieCardW - chartSize) / 2;

    doc.addImage(imgData, "PNG", chartX, chartY, chartSize, chartSize);

    // legend directly under chart
    const legendBaseY = chartY + chartSize + 14;

    // Raw list, then remove "Interest Saved" if value is 0
    const sectionsRaw = [
      { key: "principal", label: "Principal",      value: principal,     color: [11, 94, 215] },
      { key: "interest",  label: "Interest",       value: totalInterest, color: [249, 115, 22] },
      { key: "saved",     label: "Interest Saved", value: interestSaved, color: [34, 197, 94] }
    ];
    const sections = sectionsRaw.filter(s => s.key !== "saved" || s.value > 0);

    const count = sections.length;
    const totalLegendWidth = pieCardW - 64; // some left-right padding
    const gap = totalLegendWidth / count;
    let lx = pieCardX + 32;

    sections.forEach((s, idx) => {
      const cxDot = lx;
      const cyDot = legendBaseY - 4;

      // dot
      doc.setFillColor(s.color[0], s.color[1], s.color[2]);
      doc.circle(cxDot, cyDot, 4, "F");

      // label
      doc.setFont("helvetica", "normal");
      doc.setFontSize(8);
      doc.setTextColor(55, 65, 81);
      doc.text(s.label, cxDot + 10, legendBaseY);

      // value (NO ‚Çπ symbol now)
      doc.setFont("helvetica", "bold");
      doc.text(fmt(s.value), cxDot + 10, legendBaseY + 11);

      lx += gap;
    });
  })();

  // ---------- TABLE TITLE ----------
  const tableStartY = cardY + cardH + 40;

  doc.setFont("helvetica", "bold");
  doc.setFontSize(12);
  doc.setTextColor(15, 23, 42);
  doc.text("Detailed Amortization Schedule", margin, tableStartY - 8);

  doc.setFont("helvetica", "normal");
  doc.setFontSize(9);
  doc.setTextColor(107, 114, 128);
  doc.text(
    "",
    margin,
    tableStartY + 6
  );

  // ---------- TABLE DATA ----------
  const head = hasPart
    ? [["Month", "EMI", "Principal", "Interest", "Part Payment", "Outstanding"]]
    : [["Month", "EMI", "Principal", "Interest", "Outstanding"]];

  const body = scheduleData.map(r =>
    hasPart
      ? [r.month, fmt(r.emi), fmt(r.principalPaid), fmt(r.interestPaid), fmt(r.partPayment), fmt(r.outstanding)]
      : [r.month, fmt(r.emi), fmt(r.principalPaid), fmt(r.interestPaid), fmt(r.outstanding)]
  );

  doc.autoTable({
    startY: tableStartY + 14,
    head: head,
    body: body,
    styles: { fontSize: 8 },
    headStyles: {
      fillColor: [241, 245, 249],
      textColor: 30,
      lineWidth: 0.25,
      lineColor: [203, 213, 225]
    },
    bodyStyles: { lineWidth: 0.1, lineColor: [226, 232, 240] },
    margin: { left: margin, right: margin },
    theme: "grid",
    didDrawPage: function (data) {
      const page = doc.internal.getNumberOfPages();
      doc.setFontSize(8);
      doc.setTextColor(148, 163, 184);
      doc.text("Page " + page, data.settings.margin.left, doc.internal.pageSize.height - 10);
      doc.text(
        "Generated via TechFinserv EMI Calculator",
        pageW - data.settings.margin.right - 190,
        doc.internal.pageSize.height - 10
      );
    }
  });

  doc.save("emi_schedule.pdf");
}
    downloadXLSXBtn.addEventListener('click', exportXLSX);
    downloadPDFBtn.addEventListener('click', exportPDF);

    renderPayments();
    initCharts();
    computeAndRender();
  </script>
</body>
</html>
