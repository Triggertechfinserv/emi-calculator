<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SIP Calculator — TechFinserv</title>
  <meta name="description" content="TechFinserv's SIP Calculator lets you estimate returns for SIP and Step Up SIP with XIRR and Absolute Return." />
  <link rel="icon" type="image/png" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#f6f9ff;
      --accent-1:#0ea5e9;
      --accent-2:#10b981;
      --muted:#475569;
      --text:#0f172a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--text);}

    /* Header */
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    .topbar{position:relative;background:rgba(255,255,255,0.68);border-bottom:1px solid rgba(2,6,23,0.12);}
    header.nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0;gap:12px}
    .brand-logo{height:65px;border-radius:10px;display:block}
    nav.menu{display:flex;gap:14px}
    nav.menu a{padding:8px 12px;border-radius:10px;color:var(--muted);text-decoration:none}
    .cta{background:linear-gradient(135deg,var(--accent-1),var(--accent-2));color:#fff;padding:10px 14px;border-radius:12px}

    /* Mobile toggle - default hidden, shown on small screens */
    .mobile-menu-toggle {
      display:none;
      border:0;
      background:transparent;
      padding:8px;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      z-index:60;
    }
    .mobile-menu-toggle span {
      display:block;
      height:3px;
      width:22px;
      background:var(--text);
      border-radius:3px;
      margin:3px 0;
    }
    .mobile-menu{display:none;flex-direction:column;gap:6px;padding:10px 0;background:#fff;border-bottom:1px solid rgba(2,6,23,0.12)}
    .mobile-menu a{padding:12px 16px;color:var(--muted);text-decoration:none}

    /* Calculator layout */
    .calc-main{display:flex;justify-content:center;gap:18px;padding:18px 0 42px;align-items:flex-start}
    .calc-content{width:100%;max-width:980px;margin:12px}
    .card{background:rgba(255,255,255,0.79);border-radius:22px;border:1px solid rgba(2,6,23,0.12);box-shadow:0 12px 34px rgba(2,6,23,0.1);padding:20px;display:flex;gap:20px;flex-wrap:wrap}
    .calcform{flex:1 1 320px;min-width:260px;max-width:420px;display:flex;flex-direction:column;gap:16px}

    .input-label{font-size:15px;margin-bottom:8px;color:var(--muted)}
    /* input row container */
    .input-wrap{display:flex;align-items:center;gap:12px;margin-bottom:8px;width:100%}
    .input-wrap .range { flex:1; }
    .input-addon-group {
      position:relative;
      display:inline-flex;
      align-items:center;
      width:150px;
      height:44px;
      flex:0 0 150px;
    }
    .input-addon-group input[type=number]{
      background:#e0f2fe;color:var(--accent-1);border-radius:10px;border:1.8px solid #bae6fd;
      font-weight:700;font-size:17px;padding:8px 38px 8px 36px;text-align:center;width:150px;outline:none;
    }
    .input-addon-start,.input-addon-end{
      position:absolute;top:50%;transform:translateY(-50%);pointer-events:none;user-select:none;z-index:2;
      color:var(--accent-1);font-weight:700;font-size:16px;
    }
    .input-addon-start{left:12px}
    .input-addon-end{right:12px}

    /* mobile-specific fixes (important) */
    @media (max-width:900px) {
      /* show hamburger earlier to match many phones */
      .mobile-menu-toggle{display:inline-flex}
      nav.menu{display:none}
    }

    @media (max-width:560px){
      /* Make header toggle visible and prominent */
      .brand-logo{height:48px}
      .mobile-menu-toggle{display:inline-flex;padding:8px}
      .mobile-menu-toggle span{width:26px;height:4px;background:var(--text)}
      nav.menu{display:none}

      /* For inputs: compact numeric box on the right of slider */
      .input-wrap{flex-direction:row;align-items:center;gap:10px}
      .input-wrap .range{flex:1} /* slider expands */
      .input-addon-group{
        /* smaller numeric box to the right */
        width:88px;
        flex:0 0 88px;
        height:40px;
      }
      .input-addon-group input[type=number]{
        width:88px;
        padding-left:26px;   /* ensure rupee symbol not overlap */
        padding-right:10px;
        text-align:left;     /* left align number for readability */
        font-size:15px;
      }
      .input-addon-start{left:8px;font-size:14px}
      .input-addon-end{right:8px;font-size:14px}

      /* ensure the rupee symbol and number never touch */
      .input-addon-group input[type=number]::placeholder{opacity:0.6}
    }

    /* Chart legend spacing fix (prevent merging) */
    .chart-legend{display:flex;gap:12px;margin-top:10px;justify-content:center;flex-wrap:wrap}
    .chart-legend div{display:flex;align-items:center;gap:8px;padding:4px 6px;white-space:nowrap}
    .dot{width:14px;height:14px;border-radius:50%}
    .dot-blue{background:#2563eb}
    .dot-green{background:#10b981}
  </style>
</head>
<body>
  <!-- Header -->
  <div class="topbar">
    <div class="container">
      <header class="nav">
        <a href="/" aria-label="TechFinserv home">
          <img class="brand-logo" src="images/techfinserv-logo.png" alt="TechFinserv logo">
        </a>

        <nav class="menu" aria-label="Primary">
          <a href="/">Home</a>
          <a href="blogs/">Blog</a>
          <a href="emi-calculator.html">EMI calculator</a>
          <a href="#contact" class="cta">Contact</a>
        </nav>

        <!-- mobile toggle -->
        <button class="mobile-menu-toggle" aria-label="Toggle menu" aria-expanded="false" aria-controls="mobileMenu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </header>

      <nav id="mobileMenu" class="mobile-menu" aria-label="Mobile">
        <a href="/">Home</a>
        <a href="blogs/">Blog</a>
        <a href="emi-calculator.html">EMI calculator</a>
        <a href="#contact" style="font-weight:600;color:var(--accent-1)">Contact</a>
      </nav>
    </div>
  </div>

  <!-- Calculator area (kept your calculator logic unchanged) -->
  <div class="calc-main">
    <div class="calc-content">
      <div class="card" role="region" aria-label="SIP Calculator">
        <form class="calcform" oninput="syncFields(); calculateSIP(); return false;">
          <div style="display:flex;gap:8px;">
            <button type="button" id="modeSIP" class="toggle-btn active" onclick="switchMode('sip')">SIP</button>
            <button type="button" id="modeStepUp" class="toggle-btn" onclick="switchMode('stepup')">Step Up SIP</button>
          </div>

          <!-- Example of monthly input in the new compact mobile layout -->
          <div>
            <div class="input-label">Monthly investment</div>
            <div class="input-wrap">
              <!-- slider -->
              <input class="range" type="range" min="500" max="200000" step="100" value="500" id="monthlyInvestmentSlider" />
              <!-- compact number input to the right -->
              <span class="input-addon-group">
                <span class="input-addon-start">₹</span>
                <input type="number" min="500" max="200000" step="100" value="500" id="monthlyInvestment" />
              </span>
            </div>
          </div>

          <!-- Expected return (same pattern) -->
          <div>
            <div class="input-label">Expected return rate (p.a)</div>
            <div class="input-wrap">
              <input class="range" type="range" min="4" max="25" step="0.1" value="12" id="returnRateSlider" />
              <span class="input-addon-group">
                <input type="number" min="4" max="25" step="0.1" value="12" id="returnRate" />
                <span class="input-addon-end">%</span>
              </span>
            </div>
          </div>

          <!-- Years -->
          <div>
            <div class="input-label">Time period</div>
            <div class="input-wrap">
              <input class="range" type="range" min="1" max="40" step="1" value="10" id="yearsSlider" />
              <span class="input-addon-group">
                <input type="number" min="1" max="40" step="1" value="10" id="years" />
                <span class="input-addon-end">Y</span>
              </span>
            </div>
          </div>

          <!-- Step Up (kept original structure) -->
          <div class="stepup-wrap" id="stepupWrap" style="display:none">
            <div class="input-label">Annual Step Up Rate</div>
            <div class="input-wrap">
              <input class="range" type="range" min="0" max="30" step="1" value="10" id="stepupRateSlider" />
              <span class="input-addon-group">
                <input type="number" min="0" max="30" step="1" value="10" id="stepupRate" />
                <span class="input-addon-end">%</span>
              </span>
            </div>
          </div>

          <button type="submit" class="invest-btn" style="background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#fff;padding:12px;border-radius:10px;border:0">INVEST NOW</button>
        </form>

        <!-- Chart & legend (legend spacing fixed) -->
        <div style="flex:0 0 360px;max-width:360px;margin:auto">
          <canvas id="sipChart" height="210" aria-label="SIP chart"></canvas>
          <div class="chart-legend" role="list">
            <div role="listitem"><span class="dot dot-blue" aria-hidden="true"></span><span>Invested amount</span></div>
            <div role="listitem"><span class="dot dot-green" aria-hidden="true"></span><span>Est. returns</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- footer minimal for this snippet -->
  <footer style="text-align:center;padding:18px 0;color:var(--muted)">
    <p>Designed & Maintained by Kiran Rathva | © <span id="year"></span> TechFinserv.com</p>
  </footer>

  <script>
    // mobile menu toggle (unchanged logic)
    document.getElementById('year').textContent = new Date().getFullYear();
    (function () {
      const toggle = document.querySelector('.mobile-menu-toggle');
      const menu = document.getElementById('mobileMenu');
      if (!toggle || !menu) return;
      const setExpanded = (open) => {
        toggle.setAttribute('aria-expanded', String(open));
        menu.classList.toggle('open', open);
      };
      toggle.addEventListener('click', () => {
        const open = !menu.classList.contains('open');
        setExpanded(open);
      });
      menu.addEventListener('click', (e) => {
        if (e.target.tagName === 'A') setExpanded(false);
      });
      window.addEventListener('resize', () => {
        if (window.innerWidth > 768) setExpanded(false);
      });
    })();

    // keep your original calculator JS exactly as-is:
    function syncFields() {
      let fields = [
        ['monthlyInvestmentSlider','monthlyInvestment'],
        ['returnRateSlider','returnRate'],
        ['yearsSlider','years'],
        ['stepupRateSlider','stepupRate']
      ];
      fields.forEach(([slider, box]) => {
        let s=document.getElementById(slider),b=document.getElementById(box);
        if(!s || !b) return;
        if(document.activeElement === s) b.value = s.value;
        else if(document.activeElement === b) s.value = b.value;
      });
    }
    function switchMode(mode) {
      document.getElementById('modeSIP').classList.toggle('active', mode==='sip');
      document.getElementById('modeStepUp').classList.toggle('active', mode==='stepup');
      document.getElementById('stepupWrap').style.display = (mode==='stepup' ? 'block' : 'none');
      calculateSIP();
    }
    function inrFormat(num) {
      return '₹' + Math.round(num).toLocaleString('en-IN');
    }
    function calculateXIRR(cashflows, dates, guess) {
      let x0 = guess || 0.1, tol = 1e-6, iter = 80;
      function daysBetween(d1,d2){return (d1-d2)/(1000*3600*24);}
      function f(rate) {
        let res = 0, d0 = dates[0];
        for(let i=0; i<cashflows.length; ++i)
          res += cashflows[i] / Math.pow(1+rate, daysBetween(dates[i],d0)/365);
        return res;
      }
      let r = x0;
      for(let i=0; i<iter; ++i) {
        let fr = f(r);
        let delta = 1e-6;
        let fpr = (f(r+delta)-fr)/delta;
        if(Math.abs(fpr) < tol) break;
        let r1 = r - fr/fpr;
        if(Math.abs(r1-r) < tol) return r1;
        r = r1;
      }
      return r;
    }

    // Chart + calculate logic (unchanged)
    let chart;
    function calculateSIP() {
      // your original calculation code here (unchanged)
      const P = parseFloat(document.getElementById('monthlyInvestment').value);
      const r = parseFloat(document.getElementById('returnRate').value)/100/12;
      const years = parseInt(document.getElementById('years').value);
      const N = years * 12;
      let invested = 0, maturity = 0, absReturn = 0, xirrOut = 0;

      let modeStepUp = document.getElementById('modeStepUp').classList.contains('active');
      let cashflows = [], dates = [];
      let today = new Date();
      let stepup_rate = parseFloat(document.getElementById('stepupRate') ? document.getElementById('stepupRate').value : 10)/100;

      if (!modeStepUp) {
        invested = P * N;
        maturity = P * ( (Math.pow(1+r,N) - 1) / r ) * (1 + r);
        for (let i = 0; i < N; ++i) {
          cashflows.push(-P);
          let d = new Date(today.getFullYear(), today.getMonth() + i, today.getDate());
          dates.push(d);
        }
      } else {
        invested = 0;
        maturity = 0;
        let curr = P;
        for (let y = 0; y < years; ++y) {
          for (let m = 0; m < 12; ++m) {
            invested += curr;
            let d = new Date(today.getFullYear(), today.getMonth() + y*12 + m, today.getDate());
            dates.push(d);
            cashflows.push(-curr);
            let n = (years*12)-(y*12+m);
            maturity += curr * Math.pow(1+r, n);
          }
          curr *= (1+stepup_rate);
        }
      }
      cashflows.push(maturity);
      let finaldate = new Date(today.getFullYear(), today.getMonth() + N, today.getDate());
      dates.push(finaldate);

      absReturn = invested ? ((maturity - invested) / invested) * 100 : 0;
      xirrOut = calculateXIRR(cashflows, dates, 0.11);

      let returns = maturity - invested;
      // ensure result elements exist before writing
      if(document.getElementById('resultInvested')) document.getElementById('resultInvested').textContent = inrFormat(invested);
      if(document.getElementById('resultReturns')) document.getElementById('resultReturns').textContent = inrFormat(returns);
      if(document.getElementById('resultTotal')) document.getElementById('resultTotal').textContent = inrFormat(maturity);
      if(document.getElementById('resultAbs')) document.getElementById('resultAbs').textContent = absReturn ? absReturn.toFixed(2) + '%' : '0%';
      if(document.getElementById('resultXIRR')) document.getElementById('resultXIRR').textContent = xirrOut ? (xirrOut*100).toFixed(2) + '%' : '0%';

      // Chart drawing
      const ctx = document.getElementById('sipChart') && document.getElementById('sipChart').getContext('2d');
      if (ctx) {
        if (chart) chart.destroy();
        chart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ["Invested amount", "Est. returns"],
            datasets: [{ data: [invested, returns], backgroundColor: ["#2563eb", "#10b981"] }]
          },
          options: { cutout: '70%', plugins: { legend: { display: false } } }
        });
      }
    }

    window.onload = function () {
      let fields = [
        ['monthlyInvestmentSlider','monthlyInvestment'],
        ['returnRateSlider','returnRate'],
        ['yearsSlider','years'],
        ['stepupRateSlider','stepupRate']
      ];
      fields.forEach(([slider, box]) => {
        let s = document.getElementById(slider), b = document.getElementById(box);
        if(!s || !b) return;
        s.addEventListener('input', function() { b.value = this.value; calculateSIP(); });
        b.addEventListener('input', function() { s.value = this.value; calculateSIP(); });
      });
      calculateSIP();
    }
  </script>
</body>
</html>
