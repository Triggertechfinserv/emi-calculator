<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Loan Eligibility Comparison - TechFinserv</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --accent:#003366;
      --accent-2:#0b63b7;
      --bg:#f6f7fb;
      --card:#ffffff;
      --muted:#6b7280;
      --max-width:1150px;
      --radius:12px;
      --ok:#0a7a53;
      --no:#b91c1c;
      --line:#eef2f7;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:#0f172a;-webkit-font-smoothing:antialiased;}
    .container{max-width:var(--max-width);margin:20px auto;padding:0 16px}

    /* Header */
    header.site-header{background:var(--card);box-shadow:0 2px 6px rgba(15,23,42,0.06);padding:0px 16px;position:relative;}
    .header-inner{max-width:var(--max-width);margin:0 auto;display:flex;align-items:center;gap:16px;}
    .logo{display:block;max-height:64px;height:auto;width:auto;}
    @media(min-width:1024px){.logo{max-height:80px}}
    .header-cta{margin-left:auto;display:flex;gap:10px;align-items:center;padding:8px 0;}
    .btn{padding:8px 12px;border-radius:8px;background:var(--accent);color:#fff;font-weight:600;border:0;cursor:pointer;}
    .btn-ghost{background:transparent;border:1px solid rgba(3,66,102,0.08);color:var(--accent);}
    .pdf-btn{background:linear-gradient(180deg,#0b63b7,#084e8f);box-shadow:0 6px 18px rgba(3,66,102,0.12)}

    /* Cards & Inputs */
    .card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 10px 30px rgba(12,18,30,0.06)}
    h1{margin:0 0 8px 0;color:var(--accent);font-size:20px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px;}
    .grid>div{display:flex;flex-direction:column;gap:6px;}
    label{font-size:13px;color:#0f172a}
    input,select{padding:10px;border-radius:10px;border:1px solid #e6e8eb;font-size:14px;background:#fff;box-sizing:border-box}
    .note{margin-top:8px;color:var(--muted);font-size:12px}

    /* Table */
    .compare-wrap{margin-top:18px}
    .compare{width:100%;border-collapse:collapse;background:var(--card);border-radius:16px;overflow:hidden;box-shadow:0 12px 34px rgba(12,18,30,0.07);}
    .compare th{background:#fff;font-weight:700;color:var(--accent);padding:14px 12px;border-bottom:2px solid var(--line);text-align:center;}
    .compare td{padding:12px;border-bottom:1px solid var(--line);text-align:center;font-size:14px;}
    .row-title{text-align:left;font-weight:600;color:#111827;}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700;}
    .badge.ok{background:#ecfdf5;color:var(--ok);border:1px solid #bbf7d0;}
    .badge.no{background:#fef2f2;color:var(--no);border:1px solid #fecaca;}

    /* Mobile */
    @media(max-width:1024px){.grid{grid-template-columns:repeat(2,1fr);gap:14px}}
    @media(max-width:768px){
      .grid{grid-template-columns:1fr;gap:14px}
      .compare{display:none}
      .mobile-cards{display:grid;gap:16px;margin-top:16px}
      input,select{font-size:15px;padding:12px}
      h1{font-size:18px}
    }
    @media(max-width:480px){
      body{font-size:14px}
      .btn{font-size:12px;padding:10px}
      .header-cta{flex-wrap:wrap;gap:8px}
      .logo{max-height:50px}
    }
    .mobile-cards .bank-card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(12,18,30,0.08);}
    .mobile-cards .bank-card h3{margin:0 0 10px 0;font-size:16px;color:var(--accent);display:flex;align-items:center;gap:8px;}
    .mobile-cards .bank-card h3 img{height:26px;object-fit:contain;}
    .mobile-cards .kv{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--line);font-size:14px;}
    .mobile-cards .kv:last-child{border-bottom:0}
  </style>

  <!-- jsPDF + AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <a href="index.html"><img class="logo" src="images/techfinserv-logo.png" alt="Tech Finserv logo"></a>
      <div class="header-cta">
        <a class="btn" href="index.html" aria-current="page">Home</a>
        <a class="btn" href="emi-calculator.html">EMI Calculator</a>
        <button id="downloadPdf" class="btn pdf-btn">Download PDF</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card" aria-labelledby="title">
      <h1 id="title">Loan Eligibility — Compare Banks</h1>
      <div class="grid" id="inputs">
        <div><label for="salary">Net Salary (per month)</label><input id="salary" type="number" inputmode="numeric" value="0"></div>
        <div><label for="oblig">Monthly Obligations / EMIs</label><input id="oblig" type="number" value="0"></div>
        <div><label for="cc">Total Credit Card Outstanding</label><input id="cc" type="number" value="0"></div>
        <div><label for="tenure">Tenure (years)</label><input id="tenure" type="number" step="0.5" value="5"></div>
        <div><label for="rate">Interest Rate (annual %)</label><input id="rate" type="number" step="0.01" value="14.5"></div>
        <div><label for="home">Home loan on applicant</label><select id="home"><option value="no">No</option><option value="yes">Yes</option></select></div>
      </div>
      <div class="note">Credit card monthly obligation = 5% of outstanding. Final = lower of FOIR vs Multiplier. Final &lt; 100,000 → Not eligible.</div>
    </section>

    <section class="compare-wrap" aria-label="Comparison table">
      <table class="compare" id="compareTable">
        <thead>
          <tr>
            <th>Metric</th>
            <th><img src="images/bajaj.png" style="height:30px;display:block;margin:0 auto 6px;"><div>Bajaj Finance</div></th>
            <th><img src="images/tata.png" style="height:30px;display:block;margin:0 auto 6px;"><div>Tata Capital</div></th>
            <th><img src="images/hdfc.png" style="height:30px;display:block;margin:0 auto 6px;"><div>HDFC Bank</div></th>
          </tr>
        </thead>
        <tbody>
          <tr><td class="row-title">Max EMI Allowed</td><td id="bajaj_max"></td><td id="tata_max"></td><td id="hdfc_max"></td></tr>
          <tr><td class="row-title">Applicable FOIR (%)</td><td id="bajaj_foir_pct"></td><td id="tata_foir_pct"></td><td id="hdfc_foir_pct"></td></tr>
          <tr><td class="row-title">Eligibility (FOIR)</td><td id="bajaj_foir"></td><td id="tata_foir"></td><td id="hdfc_foir"></td></tr>
          <tr><td class="row-title">Eligibility (Multiplier)</td><td id="bajaj_mul"></td><td id="tata_mul"></td><td id="hdfc_mul"></td></tr>
          <tr><td class="row-title">Final Eligibility</td><td id="bajaj_final"></td><td id="tata_final"></td><td id="hdfc_final"></td></tr>
          <tr><td class="row-title">Verdict</td><td><span id="bajaj_badge" class="badge"></span></td><td><span id="tata_badge" class="badge"></span></td><td><span id="hdfc_badge" class="badge"></span></td></tr>
        </tbody>
      </table>
    </section>

    <section class="mobile-cards" id="mobileCards" style="display:none;"></section>
  </main>

  <footer style="text-align:center;padding:18px;color:var(--muted);font-size:13px">Design and Maintained By Kiran Rathva</footer>

<script>
(function(){
  const { jsPDF } = window.jspdf;
  const CC_PERCENT = 0.05;
  const ELIGIBILITY_FLOOR = 100000;

  // bank rules
  const banks = {
    bajaj: { name:'Bajaj Finance', multiplier:20, bands:[{min:0,max:50000,foir:0.60},{min:50000,max:100000,foir:0.65},{min:100000,max:Infinity,foir:0.70}], specialHomeLoan:{min:50000,max:100000,foir:0.70}},
    tata:  { name:'Tata Capital', multiplier:25, bands:[{min:0,max:50000,foir:0.60},{min:50000,max:75000,foir:0.65},{min:75000,max:Infinity,foir:0.75}]},
    hdfc:  { name:'HDFC Bank', multiplier:null, bands:[{min:0,max:50000,foir:0.60},{min:50000,max:70000,foir:0.65},{min:70000,max:Infinity,foir:0.70}], specialHomeLoan:{min:50000,max:70000,foir:0.70}}
  };

  // dom refs
  const salaryEl = document.getElementById('salary');
  const obligEl   = document.getElementById('oblig');
  const ccEl      = document.getElementById('cc');
  const tenureEl  = document.getElementById('tenure');
  const rateEl    = document.getElementById('rate');
  const homeEl    = document.getElementById('home');

  const mobileCardsWrap = document.getElementById('mobileCards');

  function fmt(n){ return new Intl.NumberFormat('en-IN',{maximumFractionDigits:0}).format(Math.round(n||0)); }

  function pv(rate, nper, pmt){
    if(nper===0) return 0;
    if(Math.abs(rate) < 1e-12) return pmt * nper;
    return pmt * (1 - Math.pow(1 + rate, -nper)) / rate;
  }

  function getFoir(bank, salary, hasHome){
    if(bank.specialHomeLoan && hasHome){
      const s = bank.specialHomeLoan;
      if(salary >= s.min && salary < s.max) return s.foir;
    }
    for(const band of bank.bands) if(salary >= band.min && salary < band.max) return band.foir;
    return bank.bands[bank.bands.length-1].foir;
  }

  function compute(bankKey, sal, obl, cc, tenureYears, annualRate, hasHome){
    const b = banks[bankKey];
    const foir = getFoir(b, sal, hasHome);
    const ccMonthly = cc * CC_PERCENT;
    const maxEmiAllowed = Math.max(0, (sal * foir) - obl - ccMonthly);
    const months = Math.max(1, Math.round(tenureYears * 12));
    const monthlyRate = Math.max(0, annualRate / 12 / 100);
    const eligByFoir = Math.max(0, Math.round(pv(monthlyRate, months, maxEmiAllowed)));
    const eligByMultiplier = b.multiplier ? Math.round(sal * b.multiplier) : null;
    const finalElig = (eligByMultiplier === null) ? eligByFoir : Math.min(eligByFoir, eligByMultiplier);
    const ok = finalElig >= ELIGIBILITY_FLOOR;
    return { foir, ccMonthly, maxEmiAllowed, eligByFoir, eligByMultiplier, finalElig, ok };
  }

  function render(){
    const sal = Math.max(0, Number(salaryEl.value) || 0);
    const obl = Math.max(0, Number(obligEl.value) || 0);
    const cc  = Math.max(0, Number(ccEl.value) || 0);
    const t   = Math.max(0.5, Number(tenureEl.value) || 0.5);
    const r   = Math.max(0, Number(rateEl.value) || 0);
    const home= homeEl.value === 'yes';
    const res = {
      bajaj: compute('bajaj', sal, obl, cc, t, r, home),
      tata:  compute('tata',  sal, obl, cc, t, r, home),
      hdfc:  compute('hdfc',  sal, obl, cc, t, r, home)
    };

    // populate desktop cells
    ['bajaj','tata','hdfc'].forEach(k=>{
      document.getElementById(k+'_max').textContent = fmt(res[k].maxEmiAllowed);
      document.getElementById(k+'_foir_pct').textContent = (res[k].foir*100).toFixed(0) + '%';
      document.getElementById(k+'_foir').textContent = fmt(res[k].eligByFoir);
      document.getElementById(k+'_mul').textContent = res[k].eligByMultiplier ? fmt(res[k].eligByMultiplier) : 'N/A';
      document.getElementById(k+'_final').textContent = fmt(res[k].finalElig);
      const badge = document.getElementById(k+'_badge');
      badge.textContent = res[k].ok ? 'Eligible' : 'Not eligible';
      badge.className = 'badge ' + (res[k].ok ? 'ok' : 'no');
    });

    renderMobileCards(res);
    return { inputs:{ sal, obl, cc, t, r, home }, res };
  }

  function renderMobileCards(res){
    // show mobile cards only on small screens; JS still prepares content
    mobileCardsWrap.innerHTML = '';
    const list = [{k:'bajaj',name:'Bajaj',img:'images/bajaj.png'},{k:'tata',name:'Tata',img:'images/tata.png'},{k:'hdfc',name:'HDFC',img:'images/hdfc.png'}];
    list.forEach(b=>{
      const r = res[b.k];
      const card = document.createElement('div');
      card.className = 'bank-card';
      card.innerHTML = `
        <div class="top"><img src="${b.img}" alt="${b.name}"><h3>${b.name}</h3></div>
        <div class="kv"><span>Max EMI Allowed</span><strong>${fmt(r.maxEmiAllowed)}</strong></div>
        <div class="kv"><span>FOIR %</span><strong>${(r.foir*100).toFixed(0)}%</strong></div>
        <div class="kv"><span>Eligibility (FOIR)</span><strong>${fmt(r.eligByFoir)}</strong></div>
        <div class="kv"><span>Eligibility (Multiplier)</span><strong>${r.eligByMultiplier ? fmt(r.eligByMultiplier) : 'N/A'}</strong></div>
        <div class="kv"><span>Final Eligibility</span><strong>${fmt(r.finalElig)}</strong></div>
        <div class="kv"><span>Verdict</span><strong style="color:${r.ok ? '#0a7a53' : '#b91c1c'}">${r.ok ? 'Eligible' : 'Not eligible'}</strong></div>
      `;
      mobileCardsWrap.appendChild(card);
    });
    // show/hide container based on viewport
    if (window.innerWidth <= 768) {
      mobileCardsWrap.style.display = 'grid';
    } else {
      mobileCardsWrap.style.display = 'none';
    }
  }

  // wire events
  document.querySelectorAll('input,select').forEach(el=>el.addEventListener('input', debounce(render,120)));
  window.addEventListener('resize', () => { renderMobileCards(render().res); });
  render();

  // utility: debounce
  function debounce(fn, ms){ let t; return function(){ clearTimeout(t); t=setTimeout(()=>fn.apply(this,arguments), ms);} }

  // convert image element to dataURL (best-effort, handles CORS gracefully)
  function imgToDataURL(imgSrc, maxSize=120){
    return new Promise(resolve=>{
      if(!imgSrc) return resolve(null);
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = function(){
        try {
          const scale = Math.min(maxSize / img.width, maxSize / img.height, 1);
          const w = Math.round(img.width * scale), h = Math.round(img.height * scale);
          const canvas = document.createElement('canvas'); canvas.width = w; canvas.height = h;
          const ctx = canvas.getContext('2d'); ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,w,h); ctx.drawImage(img,0,0,w,h);
          resolve(canvas.toDataURL('image/png'));
        } catch(e){ resolve(null); }
      };
      img.onerror = function(){ resolve(null); };
      img.src = imgSrc;
      if(img.complete) img.onload();
    });
  }

  // preload logos (best-effort) so PDF can embed them
  let logoB=null, logoT=null, logoH=null;
  (async function preload(){
    logoB = await imgToDataURL('images/bajaj.png'); logoT = await imgToDataURL('images/tata.png'); logoH = await imgToDataURL('images/hdfc.png');
    window.logoB = logoB; window.logoT = logoT; window.logoH = logoH;
  })();

  // PDF export (modern layout with colored verdict chips)
  document.getElementById('downloadPdf').addEventListener('click', async function(){
    const { inputs, res } = render();
    const doc = new jsPDF({ unit:'pt', format:'a4' });
    const pageW = doc.internal.pageSize.getWidth(), margin = 36;
    let y = margin;

    // header band
    doc.setFillColor(0,51,102); doc.rect(0,0,pageW,64,'F');
    doc.setFontSize(16); doc.setTextColor(255,255,255); doc.text('Loan Eligibility Comparison', margin, 42);
    doc.setFontSize(9); doc.setTextColor(220,220,220); doc.text(`Generated: ${new Date().toLocaleString()}`, pageW - margin, 42, { align: 'right' });

    y = 92;
    // inputs cards (two-column)
    const colGap = 12;
    const colW = (pageW - margin*2 - colGap)/2;
    const cardH = 52;
    const leftX = margin, rightX = margin + colW + colGap;

    doc.setFillColor(249,250,255); doc.roundedRect(margin, y-8, pageW - margin*2, 28, 6, 6, 'F');
    doc.setFontSize(12); doc.setTextColor(20); doc.text('User Inputs', margin + 8, y - 0);
    y += 18;

    function drawInputBox(x, top, label, value){
      doc.setDrawColor(220); doc.roundedRect(x, top, colW, cardH, 8, 8);
      doc.setFontSize(9); doc.setTextColor(110); doc.text(label, x + 10, top + 14);
      doc.setFontSize(12); doc.setTextColor(20); doc.setFont(undefined, 'bold'); doc.text(String(value), x + 10, top + 32);
      doc.setFont(undefined, 'normal');
    }

    drawInputBox(leftX, y, 'Net Salary (monthly)', fmt(inputs.sal));
    drawInputBox(rightX, y, 'Credit Card Outstanding', fmt(inputs.cc));
    y += cardH + 10;
    drawInputBox(leftX, y, 'Monthly Obligations / EMIs', fmt(inputs.obl));
    drawInputBox(rightX, y, 'Tenure (years)', inputs.t);
    y += cardH + 10;
    drawInputBox(leftX, y, 'Interest rate (annual %)', inputs.r);
    drawInputBox(rightX, y, 'Home loan on applicant', inputs.home ? 'Yes' : 'No');
    y += cardH + 22;

    // comparison title
    doc.setFillColor(250,250,255); doc.roundedRect(margin, y-8, pageW - margin*2, 28, 6,6,'F');
    doc.setFontSize(12); doc.setTextColor(20); doc.text('Comparison — Eligibility per Bank', margin + 8, y - 0);
    y += 20;

    // table data
    const head = [['Metric','Bajaj','Tata','HDFC']];
    const body = [
      ['Max EMI Allowed', fmt(res.bajaj.maxEmiAllowed), fmt(res.tata.maxEmiAllowed), fmt(res.hdfc.maxEmiAllowed)],
      ['Applicable FOIR (%)', (res.bajaj.foir*100).toFixed(0)+'%', (res.tata.foir*100).toFixed(0)+'%', (res.hdfc.foir*100).toFixed(0)+'%'],
      ['Eligibility (FOIR)', fmt(res.bajaj.eligByFoir), fmt(res.tata.eligByFoir), fmt(res.hdfc.eligByFoir)],
      ['Eligibility (Multiplier)', res.bajaj.eligByMultiplier ? fmt(res.bajaj.eligByMultiplier) : 'N/A', res.tata.eligByMultiplier ? fmt(res.tata.eligByMultiplier) : 'N/A', res.hdfc.eligByMultiplier ? fmt(res.hdfc.eligByMultiplier) : 'N/A'],
      ['Final Eligibility', fmt(res.bajaj.finalElig), fmt(res.tata.finalElig), fmt(res.hdfc.finalElig)],
      ['Verdict', res.bajaj.ok ? 'Eligible' : 'Not eligible', res.tata.ok ? 'Eligible' : 'Not eligible', res.hdfc.ok ? 'Eligible' : 'Not eligible']
    ];

    doc.autoTable({
      startY: y,
      head: head,
      body: body,
      theme: 'grid',
      styles: { fontSize:10, cellPadding:6, halign:'center', textColor:30 },
      headStyles: { fillColor:[3,51,102], textColor:255, fontStyle:'bold' },
      columnStyles: { 0: { halign:'left', cellWidth:160 } },
      didDrawCell: function(data){
        // header logos (best-effort)
        if(data.section==='head' && data.row.index===0 && data.column.index>0){
          const logos = [null, window.logoB, window.logoT, window.logoH];
          const logo = logos[data.column.index];
          if(logo){
            const imgW = 30, imgH = 30;
            const x = data.cell.x + (data.cell.width - imgW)/2;
            const yImg = data.cell.y + (data.cell.height - imgH)/2;
            try{ doc.addImage(logo, 'PNG', x, yImg, imgW, imgH); }catch(e){}
          }
        }
        // style verdict row with colored chips (green/red)
        if(data.section==='body' && data.row.index===5 && data.column.index>0){
          const txt = data.cell.text.join('');
          const isOk = txt.toLowerCase().includes('eligible');
          const chipW = 90, chipH = 20;
          const chipX = data.cell.x + (data.cell.width - chipW)/2;
          const chipY = data.cell.y + (data.cell.height - chipH)/2;
          if(isOk){
            doc.setFillColor(236,253,245); doc.setDrawColor(187,247,208); doc.roundedRect(chipX, chipY, chipW, chipH, 8,8,'F');
            doc.setFontSize(9); doc.setTextColor(6,110,67); doc.text(txt, chipX + chipW/2, chipY + chipH/2 + 2, { align:'center', baseline:'middle' });
          } else {
            doc.setFillColor(255,230,230); doc.setDrawColor(250,190,190); doc.roundedRect(chipX, chipY, chipW, chipH, 8,8,'F');
            doc.setFontSize(9); doc.setTextColor(180,20,20); doc.text(txt, chipX + chipW/2, chipY + chipH/2 + 2, { align:'center', baseline:'middle' });
          }
        }
      },
      margin: { left: margin, right: margin }
    });

    // footer & page numbers
    const pages = doc.internal.getNumberOfPages();
    for(let i=1;i<=pages;i++){
      doc.setPage(i);
      doc.setFontSize(9); doc.setTextColor(120);
      doc.text('Design and Maintained By Kiran Rathva', margin, doc.internal.pageSize.getHeight()-18);
      doc.text('Page ' + i, doc.internal.pageSize.getWidth() - margin - 50, doc.internal.pageSize.getHeight()-18);
    }

    const stamp = new Date().toISOString().replace(/[:.]/g,'-');
    doc.save(`loan-eligibility-${stamp}.pdf`);
  });

})();
</script>
</body>
</html>
